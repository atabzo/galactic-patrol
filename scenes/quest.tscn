[gd_scene load_steps=17 format=3 uid="uid://cx4nvljesj1fl"]

[ext_resource type="PackedScene" uid="uid://bwdilim1wy6xl" path="res://scenes/alert_panel.tscn" id="1_0vetw"]
[ext_resource type="PackedScene" uid="uid://doqhhk0o3kfih" path="res://scenes/cosmos-background.tscn" id="1_k76xp"]
[ext_resource type="Texture2D" uid="uid://nx5gtlfhwk6w" path="res://images/icons/fire.png" id="2_aqimm"]
[ext_resource type="PackedScene" uid="uid://5itikjci4prl" path="res://scenes/spaceship.tscn" id="2_rwe2g"]
[ext_resource type="PackedScene" uid="uid://3ftjinsp46ma" path="res://scenes/planets.tscn" id="3_rwe2g"]
[ext_resource type="Script" uid="uid://bthfqeh4aq2jt" path="res://scenes/fire.gd" id="3_ttfkt"]
[ext_resource type="Script" uid="uid://c4ev6pxc4621y" path="res://scenes/camera_2d.gd" id="6_kj15b"]
[ext_resource type="FontFile" uid="uid://dkkllk7rn2lwp" path="res://fonts/bitcount.ttf" id="6_ol5eh"]
[ext_resource type="Script" uid="uid://bsvahj5uil5l3" path="res://scenes/exit-button.gd" id="7_kj15b"]
[ext_resource type="AudioStream" uid="uid://d2pnb8vk1nta7" path="res://audios/sound-click.mp3" id="10_62uld"]
[ext_resource type="AudioStream" uid="uid://bubpe56udrtls" path="res://audios/cinematic.mp3" id="11_k76xp"]
[ext_resource type="Script" uid="uid://demmfb414ncfe" path="res://scenes/elemental-scripts/quest-subtitles.gd" id="12_0vetw"]

[sub_resource type="GDScript" id="GDScript_0vetw"]
script/source = "extends Node

# Reference to the AudioStreamPlayer node
@onready var audio_player = $Cinematic

# The popup scene to instantiate
@export var popup_scene: PackedScene

# Flag to ensure we only show popup once
var popup_shown = false

func _ready():
	# Start playing audio immediately when scene loads
	if audio_player:
		audio_player.play()
	else:
		push_error(\"AudioStreamPlayer not found!\")

func _process(_delta):
	if not audio_player or not audio_player.playing:
		return
	
	# Check if we're 3 seconds away from the end
	var time_remaining = audio_player.stream.get_length() - audio_player.get_playback_position()
	
	if time_remaining <= 3.0 and not popup_shown:
		show_popup()
		popup_shown = true

func show_popup():
	if popup_scene:
		# Instance the popup scene
		var popup_instance = popup_scene.instantiate()
		
		# Add it to the scene tree
		# You can add it to self, or to get_tree().root for a global popup
		add_child(popup_instance)
		
		print(\"Popup displayed - 3 seconds remaining!\")
	else:
		push_warning(\"Popup scene not assigned in the inspector!\")
"

[sub_resource type="Animation" id="Animation_0vetw"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:player")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [null]
}

[sub_resource type="Animation" id="Animation_k76xp"]
resource_name = "pulse"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:player")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(2),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [null]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_cnmot"]
_data = {
&"RESET": SubResource("Animation_0vetw"),
&"pulse": SubResource("Animation_k76xp")
}

[node name="cosmos-quest" type="Node2D"]
script = SubResource("GDScript_0vetw")
popup_scene = ExtResource("1_0vetw")

[node name="cosmos-background" parent="." instance=ExtResource("1_k76xp")]
position = Vector2(419, 125)

[node name="fire" type="Sprite2D" parent="."]
position = Vector2(1304, 273.99997)
rotation = 0.5661373
scale = Vector2(0.20988414, 0.23116943)
skew = -0.015207529
texture = ExtResource("2_aqimm")
script = ExtResource("3_ttfkt")

[node name="Spaceship" parent="." instance=ExtResource("2_rwe2g")]
position = Vector2(1626, 689.00006)

[node name="Camera2D" type="Camera2D" parent="Spaceship"]
position = Vector2(-539.3328, -123.17297)
scale = Vector2(1, 0.9999999)
script = ExtResource("6_kj15b")

[node name="planets" parent="." instance=ExtResource("3_rwe2g")]
position = Vector2(-13, -65)

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Label" type="Label" parent="CanvasLayer"]
offset_left = 38.0
offset_top = 866.0
offset_right = 1961.0
offset_bottom = 1044.0
theme_override_fonts/font = ExtResource("6_ol5eh")
theme_override_font_sizes/font_size = 95
text = "heyhey"
script = ExtResource("12_0vetw")

[node name="AnimationPlayer" type="AnimationPlayer" parent="CanvasLayer/Label"]
libraries = {
&"": SubResource("AnimationLibrary_cnmot")
}

[node name="Button" type="Button" parent="CanvasLayer"]
offset_left = 1654.0
offset_top = 950.0
offset_right = 1900.0
offset_bottom = 1055.0
theme_override_fonts/font = ExtResource("6_ol5eh")
theme_override_font_sizes/font_size = 53
text = "exit"
script = ExtResource("7_kj15b")

[node name="SoundClick" type="AudioStreamPlayer" parent="."]
stream = ExtResource("10_62uld")

[node name="Cinematic" type="AudioStreamPlayer" parent="."]
stream = ExtResource("11_k76xp")

[node name="alert-panel" parent="." instance=ExtResource("1_0vetw")]
position = Vector2(974, -1233)
